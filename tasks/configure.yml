---
- name: update server.conf from template
  template:
    src: etc/openvpn/server.conf
    dest: /etc/openvpn/server.conf
    owner: root
    group: root
    mode: 0644
  register: server_conf

- name: generate ta.key
  command: openvpn --genkey --secret /etc/openvpn/ta.key
           creates=/etc/openvpn/ta.key

- name: restart openvpn
  service:
    name: openvpn
    state: restarted
  when: server_conf|changed
